@model Merchant
@{
    ViewData["Title"] = "Register";
}

<div class="container mt-5">
    <div class="row justify-content-center align-items-center shadow-lg rounded-4 overflow-hidden">
        <!-- Left Side: Image -->
        <div class="col-md-5 d-none d-md-block p-0">
            <img src="~/img/market.png" class="w-100" style="max-height: 500px; object-fit: cover;" alt="Merchant Market Image" />
        </div>

        <!-- Right Side: Form -->
        <div class="col-md-7 p-5 bg-white">
            <h2 class="text-primary mb-4 text-center">Merchant Registration</h2>

            <form asp-action="Register" method="post" enctype="multipart/form-data">
                <div asp-validation-summary="All" class="text-danger"></div>

                <div class="mb-3">
                    <label asp-for="Name" class="form-label">Full Name</label>
                    <input asp-for="Name" class="form-control" />
                    <span asp-validation-for="Name" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Email" class="form-label">Email Address</label>
                    <input asp-for="Email" type="email" class="form-control" />
                    <span asp-validation-for="Email" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Phone" class="form-label">Phone Number</label>
                    <input asp-for="Phone" class="form-control" />
                    <span asp-validation-for="Phone" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Address" class="form-label">Address</label>
                    <input asp-for="Address" class="form-control" id="addressInput" />
                    <span asp-validation-for="Address" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="PostalCode" class="form-label">Postal Code</label>
                    <input asp-for="PostalCode" class="form-control" />
                    <span asp-validation-for="PostalCode" class="text-danger"></span>
                </div>

                <div class="mb-3 position-relative">
                    <label asp-for="Password" class="form-label">Password</label>
                    <input asp-for="Password" type="password" class="form-control pe-5" id="passwordInput" required />
                    <span asp-validation-for="Password" class="text-danger"></span>
                    <br />
                    <span class="position-absolute top-50 end-0 translate-middle-y pe-3" style="cursor: pointer;" id="togglePassword">
                        <i class="bi bi-eye" id="togglePasswordIcon"></i>
                    </span>
                </div>

                <div class="mb-3 position-relative">
                    <label asp-for="ConfirmPassword" class="form-label">Confirm Password</label>
                    <input asp-for="ConfirmPassword" type="password" class="form-control pe-5" id="confirmPasswordInput" required />
                    <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                    <br />
                    <span class="position-absolute top-50 end-0 translate-middle-y pe-3" style="cursor: pointer;" id="toggleConfirmPassword">
                        <i class="bi bi-eye" id="toggleConfirmPasswordIcon"></i>
                    </span>
                </div>

                <div class="mb-3">
                    <label class="form-label">Profile Picture (Optional)</label>
                    <input type="file" name="profileImage" class="form-control" accept="image/*" onchange="previewProfile(event)" />
                    <div class="mt-2 text-center">
                        <img id="profilePreview" src="#" alt="Profile Preview" class="img-thumbnail rounded-circle d-none" style="max-width: 150px;" />
                    </div>
                </div>

                <button type="submit" class="btn btn-primary w-100">Register</button>

                <div class="mt-3 text-center">
                    <span>Already a merchant? <a asp-action="Login" asp-controller="MerchantAccount" class="text-decoration-none">Login here</a></span>
                </div>
            </form>

            <div class="mt-3">
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Toggle password visibility
        document.getElementById('togglePassword').addEventListener('click', function () {
            const input = document.getElementById('passwordInput');
            const icon = document.getElementById('togglePasswordIcon');
            input.type = input.type === 'password' ? 'text' : 'password';
            icon.classList.toggle('bi-eye');
            icon.classList.toggle('bi-eye-slash');
        });

        // Toggle confirm password visibility
        document.getElementById('toggleConfirmPassword').addEventListener('click', function () {
            const input = document.getElementById('confirmPasswordInput');
            const icon = document.getElementById('toggleConfirmPasswordIcon');
            input.type = input.type === 'password' ? 'text' : 'password';
            icon.classList.toggle('bi-eye');
            icon.classList.toggle('bi-eye-slash');
        });

        // Autofill address using geolocation API
        document.getElementById('addressInput').addEventListener('focus', function () {
            fetch('https://ipapi.co/json')
                .then(res => res.json())
                .then(data => {
                    this.value = `${data.city}, ${data.region}, ${data.country_name}`;
                });
        });

        // Preview profile image
        function previewProfile(event) {
            const input = event.target;
            const preview = document.getElementById('profilePreview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.classList.remove('d-none');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
}
